import{p as Q,S as z,z as Z,v as J,A as M,D as W,E as G,b as D,y as d,h as p,e as N,n as C,j as K}from"./vendor-cf07880b.js";import{b as g,u as X,g as Y,n as tt,e as T,_ as st,a as A,c as et,d as at,Z as it,f as rt,h as nt,T as U,s as ct}from"./index-19e2fe33.js";var ot=Object.defineProperty,ht=Object.getOwnPropertyDescriptor,lt=(t,s,e,i)=>{for(var a=i>1?void 0:i?ht(s,e):s,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(s,e,a):n(a))||a);return i&&a&&ot(s,e,a),a};class H extends z{constructor(s){super(),this.key="",this.key=s}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}lt([Q({value:[]})],H.prototype,"queue",2);const dt=7200*1e3;class ut{constructor(s){this.provider=X().bridgeStore.bridge.provider,this.store=new H(`evm.txs.${s||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(s){if(!s.chainId){const{network:e}=this.provider;s.chainId=e.chainId,s.scan=e.scan}s.pending=!0,this.queue.unshift(s),this.store.save(),this.provider.nonce=+s.nonce+1}delDelay(s,e=0){setTimeout(()=>this.del(s),e)}del(s){var i,a;const e=(a=(i=s.hash)!=null?i:s.ts)!=null?a:s;this.queue.some((r,n)=>{if([r.hash,r.ts,r].includes(e)){n===0&&(this.provider.nonce=0);const c=this.queue.splice(n,1);return this.store.save(),c}})}async check(s){this.queue.forEach(async(e,i)=>{if(s&&i===0){const a=await Y(this.provider.account),r=+e.nonce;this.provider.nonce=r>a?r+1:a}if(e.done||new Date().getTime()-e.ts>=dt)return this.del(e);if(!e.err&&!(!s&&e.pending)){e.pending=!0;try{const a=await this.provider.waitForTransaction(e.hash),{status:r}=a;e.status=r,r===1?(e.done=!0,this.del(e)):e.err=!0}catch(a){e.err=a}e.pending=!1}}),this.store.save()}}const L={},S=(t=g.bridge.account)=>L[t]||(L[t]=new ut(t)),ft=async t=>t?typeof t=="object"?t:await st(Object.assign({"./abi/Locker.codes.json":()=>A(()=>import("./Locker.codes-d3f42ed5.js"),[]),"./abi/Resolver.codes.json":()=>A(()=>import("./Resolver.codes-ee4f74d3.js"),[])}),`./abi/${t}.codes.json`):{};class gt{constructor(s,{errorCodes:e="",seq:i=void 0,delay:a=0,allowAlmostSuccess:r=!1,onSent:n=()=>{},onSuccess:c=()=>{},onError:o=()=>{}}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=r,this.txPromise=s,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=i,this.delay=a,this.onSent=n,this.onSuccess=c,this.onError=o}get success(){return this.status===1}get processing(){return this.status===2}get almostSuccess(){return this.status===4}get ignored(){return this.status===3}async wait(s=!1){return(async()=>{let e=!1;const i=await ft(this.errorCodes);try{const a=await this.txPromise;this.onSent(a);const{hash:r,nonce:n}=a;this.seq.nonce=n,this.seq&&(delete this.seq.overrides,S().add(Object.assign(this.seq,{hash:r}))),this.hash=r,this.status=2;const c=async()=>{const{status:o,events:l}=await a.wait(1);if(o!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");l.some(({event:m,args:b}={})=>{if(m==="Failure"){let{info:v,detail:y,error:_}=b;const j=_.toString(),I=i[_],F={code:j,message:I,error:_,info:v==null?void 0:v.toString(),detail:y==null?void 0:y.toString()};this.seq&&(this.seq.err=!0);const E=new Error(I);throw Object.assign(E,{code:j,raw:F}),this.allowAlmostSuccess&&(this.status=4),E}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?S().delDelay(r,this.delay):S().del(r)};s?(e=!0,c()):await c(),this.onSuccess(a)}catch(a){throw await tt(a),a.code===4001?this.status=3:this.status!==4&&(this.status=0),this.err=a,this.onError(a),a}finally{this.pending=!1;const a=this.status===1;T.emit("tx-status",this.hash),a&&T.emit("tx-success",this.hash),e=a}return e})()}}const P={A:2,B:4,C:6},h=t=>[t,P[t]],pt={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")},"0x5":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")}},B=[64,130],x=async t=>t||(await nt()).account,q=async()=>pt[await et()],wt=async()=>Object.fromEntries(Object.entries(await q()).map(t=>[t[1][0],t[0]])),f=async t=>at("Locker",{account:await x(t)}),O=t=>t.replace(/^0x/,""),$=t=>B[t.length<B[1]?0:1],xt=t=>(t=O(t),`0x${t.slice(0,$(t))}`),R=t=>{t=O(t);const s=$(t);return t.slice(s,s+1).toUpperCase()},mt=t=>(t=O(t),parseInt(t.slice($(t)+1,t.length)||"0",16)),$t=t=>{var s,e;return(e=P[(s=R(t))!=null?s:"C"])!=null?e:P.C},jt=async t=>{t||(t=await x(t));const s=Z(J("C"));let e="";return e=M(BigInt(t)^BigInt(s)),[e.replace("0x",""),"c","0"].join("")},It=async t=>await(await f()).nameExists(t),Et=async(t,s=!1)=>(t||(t=await x()),await(await f(t))[s?"getUserPassesInfo":"getUserPassList"](t)),bt=async t=>{let s="";if(!t||t===it)return s;const e=await f();try{s=await e.getNameByHash(W(t))}catch(i){}return s},Tt=async(t,s)=>{var r;const e=await f(s),i=await q();let a={id:t,cate:"C",len:6,name:""};try{const[n,c,o]=await e.getUserPassInfo(t),l=(r=i[c])!=null?r:Object.values(a);a={id:n,cate:l[0],hash:o,len:l[1],name:await bt(o)}}catch(n){}return a},At=async(t,s="")=>{let{id:e,code:i,cate:a}=t;const r=!!e;if(!e){i=xt(t);const b=await wt();console.log(14),a=b[R(t)],e=mt(t)}const n=await f(),c=r?"lockName":"lockPass",o={},l=r?[+e,s]:[i,s,a,+e];await rt(o,n,c,l),console.log(2);const m=n[c](...l);return new gt(m,{errorCodes:"Locker",allowAlmostSuccess:!0,seq:{type:r?"LockName":"lockPass",title:r?"Lock Name":"Lock Pass",ts:new Date().getTime(),overrides:o}})},Lt=async t=>{t||(t=await x());const e=await(await f(t)).getUserInvitedNumber(t);return G(e[1],0)},vt="";var yt=Object.defineProperty,_t=Object.getOwnPropertyDescriptor,V=(t,s,e,i)=>{for(var a=i>1?void 0:i?_t(s,e):s,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(s,e,a):n(a))||a);return i&&a&&yt(s,e,a),a};let k=class extends U(vt){constructor(){super(...arguments),this.bindBridge=new D(this,g)}get bridge(){return g.bridge}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return d`<dui-link class="uri mt-4" href="${this.txScanUri}" target="_blank" rel="noopener">View Transaction: ${ct(this.tx.hash)}</dui-link>`}};V([p({type:Object})],k.prototype,"tx",2);k=V([N("tx-view")],k);const Ct=`.tx-state{display:flex;flex-direction:column;align-items:center;flex-grow:1}.tx-state-icon.success{color:green}.tx-state-icon.failed{color:red}.tx-state-icon.warn{color:orange}.tx-state-msg{word-break:break-word;white-space:normal}
`;var St=Object.defineProperty,Pt=Object.getOwnPropertyDescriptor,w=(t,s,e,i)=>{for(var a=i>1?void 0:i?Pt(s,e):s,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(s,e,a):n(a))||a);return i&&a&&St(s,e,a),a};let u=class extends U(Ct){constructor(){super(),this.bindBridge=new D(this,g),this.txType=!1,this.onlyAwaitHash=!1,this.opts={}}get bridge(){return g.bridge}get icons(){var a;const[t='<i class="mdi mdi-check-all"></i>',s='<i class="mdi mdi-check"></i>',e='<i class="mdi mdi-close"></i>',i='<i class="mdi mdi-loading"></i>']=(a=this.opts.icons)!=null?a:[];return{success:t,failed:e,wait:i,almostSuccess:s}}get hashOk(){return this.onlyAwaitHash&&this.tx.hash}get state(){var a,r,n;let[t,s,e]=["","",""];const{state:i}=this.opts;switch(this.tx.status){case-1:[t,s,e]=[this.icons.wait,(i==null?void 0:i.wait)||"Waiting for confirmation...","wait"];break;case 0:[t,s,e]=[this.icons.failed,(r=(a=this.tx.err)==null?void 0:a.message)!=null?r:"Something went wrong","failed"];break;case 1:[t,s,e]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"];break;case 2:[t,s]=[this.icons.wait,"Confirm the transaction."];break;case 4:[t,s,e]=[this.icons.almostSuccess,((n=this.tx.err)==null?void 0:n.message)||"Almost Success","warn"];break}return this.hashOk&&([t,s,e]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"]),{icon:t,txt:s,css:e}}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return d`<div class="tx-state m-4"><div class="tx-state-icon my-3 text-3xl mx-auto ${this.state.css}">${C(this.tx.pending&&!this.hashOk,()=>d`<slot name="pending"><i class="mdi mdi-loading"></i></slot>`,()=>d`<span>${K(this.state.icon)}</span>`)}</div><div class="tx-state-msg my-4"><slot>${this.state.txt}</slot></div><div class="flex gap-4">${C(this.tx.hash,()=>d`${C(this.tx.success||this.tx.almostSuccess,()=>d`<slot name="view"><tx-view .tx="${this.tx}"></tx-view></slot>`,()=>d`<tx-view .tx="${this.tx}"></tx-view>`)}`)}</div></div>`}};w([p({type:Object})],u.prototype,"tx",2);w([p({type:Boolean})],u.prototype,"txType",2);w([p({type:Boolean})],u.prototype,"onlyAwaitHash",2);w([p({type:Object})],u.prototype,"opts",2);u=w([N("tx-state")],u);export{B as L,jt as a,Tt as b,It as c,Lt as d,f as e,Et as f,$t as g,q as h,bt as i,At as l,gt as t};
