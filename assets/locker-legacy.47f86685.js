System.register(["./index-legacy.e9537f8d.js"],(function(e,t){"use strict";var s,a,i,r,c,n,o,h,d,u,f,l,w;return{setters:[e=>{s=e.w,a=e.z,i=e.a,r=e.A,c=e.B,n=e.C,o=e.f,h=e.D,d=e.E,u=e.F,f=e.G,l=e.H,w=e.I}],execute:function(){var t=Object.defineProperty,y=Object.getOwnPropertyDescriptor;class g extends a{constructor(e){super(),this.key="",this.key=e}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}((e,s,a,i)=>{for(var r,c=i>1?void 0:i?y(s,a):s,n=e.length-1;n>=0;n--)(r=e[n])&&(c=(i?r(s,a,c):r(c))||c);i&&c&&t(s,a,c)})([s({value:[]})],g.prototype,"queue",2);class p{constructor(e){this.provider=r().bridgeStore.bridge.provider,this.store=new g(`evm.txs.${e||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(e){if(!e.chainId){const{network:t}=this.provider;e.chainId=t.chainId,e.scan=t.scan}e.pending=!0,this.queue.unshift(e),this.store.save(),this.provider.nonce=+e.nonce+1}delDelay(e,t=0){setTimeout((()=>this.del(e)),t)}del(e){const t=e.hash??e.ts??e;this.queue.some(((e,s)=>{if([e.hash,e.ts,e].includes(t)){0===s&&(this.provider.nonce=0);const e=this.queue.splice(s,1);return this.store.save(),e}}))}async check(e){this.queue.forEach((async(t,s)=>{if(e&&0===s){const e=await c(this.provider.account),s=+t.nonce;this.provider.nonce=s>e?s+1:e}if(t.done||(new Date).getTime()-t.ts>=72e5)return this.del(t);if(!t.err&&(e||!t.pending)){t.pending=!0;try{const e=await this.provider.provider.waitForTransaction(t.hash),{status:s}=e;t.status=s,1===s?(t.done=!0,this.del(t)):t.err=!0}catch(a){t.err=a}t.pending=!1}})),this.store.save()}}const b={},v=(e=i.bridge.account)=>b[e]||(b[e]=new p(e));class q{constructor(e,{errorCodes:t="",seq:s,delay:a=0}={}){this.pending=!0,this.status=-1,this.txPromise=e,this.err=void 0,this.hash="",this.errorCodes=t,this.seq=s,this.delay=a}get success(){return 1===this.status}get ignored(){return 3===this.status}async wait(e=!1){return(async()=>{let t=!1;const s=await(async e=>({}))(this.errorCodes);try{const a=await this.txPromise,{hash:i,nonce:r}=a;this.seq.nonce=r,this.seq&&(delete this.seq.overrides,v().add(Object.assign(this.seq,{hash:i}))),this.hash=i,this.status=2;const c=async()=>{const{status:e,events:t}=await a.wait(1);if(1!==e)throw this.seq&&(this.seq.err=!0),new Error("Failed");t.some((({event:e,args:t}={})=>{if("Failure"===e){let{info:e,detail:a,error:i}=t;i=i.toString();const r={err:s[i],error:i,info:e?.toString(),detail:a?.toString()};throw this.seq&&(this.seq.err=!0),new Error(JSON.stringify(r))}})),this.status=1,this.seq&&(this.seq.done=!0),this.delay?v().delDelay(i,this.delay):v().del(i)};e?(t=!0,c()):await c()}catch(a){throw await n(a),this.status=0,4001===a.code&&(this.status=3),this.err=a,a}finally{this.pending=!1;const e=1===this.status;o.emit("tx-status",this.hash),e&&o.emit("tx-success",this.hash),t=e}return t})()}}const m={A:2,B:4,C:6},x=e=>[e,m[e]],k={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":x("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":x("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":x("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":x("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":x("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":x("C")}},C=130,P=async()=>(await l()).bridge,S=async e=>e||(await P()).account,I=e("d",(async()=>k[(await P()).network.current.chainId])),O=async e=>w("Locker",{account:await S(e)}),j=e=>e.replace(/^0x/,""),D=e=>j(e).slice(C,131).toUpperCase(),E=(e("g",(e=>m[D(e)??"C"]??m.C)),e("a",(async e=>{const t=await P(),s=h(d(u("C"))),a=t.provider.getSigner(e||t.account);let i="";try{i=await a.signMessage(s)}catch(r){throw await n(r)}return[i.replace("0x",""),"c","0"].join("")})),e("c",(async e=>{const t=await O();return await t.nameExists(e)})),e("e",(async(e,t=!1)=>{const s=await O(e);return await s[t?"getUserPassesInfo":"getUserPassList"](e)})),e("f",(async e=>{const t=await O();let s="";try{s=await t.getNameByHash(h(e))}catch(a){}return s})));e("b",(async(e,t)=>{const s=await O(t),a=await I();let i={id:e,cate:"C",len:6,name:""};try{const[t,r,c]=await s.getUserPassInfo(e),n=a[r]??Object.values(i);i={id:t,cate:n[0],hash:c,len:n[1],name:await E(c)}}catch(r){}return i})),e("l",(async(e,t="")=>{let{id:s,code:a,cate:i}=e;const r=!!s;s||(a=(e=>`0x${j(e).slice(0,C)}`)(e),i=(await(async()=>Object.fromEntries(Object.entries(await I()).map((e=>[e[1][0],e[0]]))))())[D(e)],s=(e=>(e=j(e),parseInt(e.slice(131,e.length)||"0",16)))(e));const c=await O(),n=r?"lockName":"lockPass",o={},h=r?[+s,t]:[a,t,i,+s];await f(o,c,n,h);const d=c[n](...h);return new q(d,{seq:{type:r?"LockName":"lockPass",title:r?"Lock Name":"Lock Pass",ts:(new Date).getTime(),overrides:o}})}))}}}));
