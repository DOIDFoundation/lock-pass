import{w,z as Q,B as m,A as N,C as G,D as A,E as J,F as Z,G as K,a as W,H as X,I as Y,J as D,f as B,K as tt,M as et,O as st,P as rt,Q as it}from"./index.039fed28.js";const c=new w(Q),y={},R=m.from(0),V=m.from(-1);function q(s,t,e,r){const i={fault:t,operation:e};return r!==void 0&&(i.value=r),c.throwError(s,w.errors.NUMERIC_FAULT,i)}let b="0";for(;b.length<256;)b+=b;function I(s){if(typeof s!="number")try{s=m.from(s).toNumber()}catch(t){}return typeof s=="number"&&s>=0&&s<=256&&!(s%1)?"1"+b.substring(0,s):c.throwArgumentError("invalid decimal size","decimals",s)}function v(s,t){t==null&&(t=0);const e=I(t);s=m.from(s);const r=s.lt(R);r&&(s=s.mul(V));let i=s.mod(e).toString();for(;i.length<e.length-1;)i="0"+i;i=i.match(/^([0-9]*[1-9]|0)(0*)/)[1];const n=s.div(e).toString();return e.length===1?s=n:s=n+"."+i,r&&(s="-"+s),s}function l(s,t){t==null&&(t=0);const e=I(t);(typeof s!="string"||!s.match(/^-?[0-9.]+$/))&&c.throwArgumentError("invalid decimal value","value",s);const r=s.substring(0,1)==="-";r&&(s=s.substring(1)),s==="."&&c.throwArgumentError("missing value","value",s);const i=s.split(".");i.length>2&&c.throwArgumentError("too many decimal points","value",s);let n=i[0],o=i[1];for(n||(n="0"),o||(o="0");o[o.length-1]==="0";)o=o.substring(0,o.length-1);for(o.length>e.length-1&&q("fractional component exceeds decimals","underflow","parseFixed"),o===""&&(o="0");o.length<e.length-1;)o+="0";const f=m.from(n),h=m.from(o);let u=f.mul(e).add(h);return r&&(u=u.mul(V)),u}class g{constructor(t,e,r,i){t!==y&&c.throwError("cannot use FixedFormat constructor; use FixedFormat.from",w.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=e,this.width=r,this.decimals=i,this.name=(e?"":"u")+"fixed"+String(r)+"x"+String(i),this._multiplier=I(i),Object.freeze(this)}static from(t){if(t instanceof g)return t;typeof t=="number"&&(t=`fixed128x${t}`);let e=!0,r=128,i=18;if(typeof t=="string"){if(t!=="fixed")if(t==="ufixed")e=!1;else{const n=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);n||c.throwArgumentError("invalid fixed format","format",t),e=n[1]!=="u",r=parseInt(n[2]),i=parseInt(n[3])}}else if(t){const n=(o,f,h)=>t[o]==null?h:(typeof t[o]!==f&&c.throwArgumentError("invalid fixed format ("+o+" not "+f+")","format."+o,t[o]),t[o]);e=n("signed","boolean",e),r=n("width","number",r),i=n("decimals","number",i)}return r%8&&c.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",r),i>80&&c.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",i),new g(y,e,r,i)}}class a{constructor(t,e,r,i){t!==y&&c.throwError("cannot use FixedNumber constructor; use FixedNumber.from",w.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=i,this._hex=e,this._value=r,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&c.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const e=l(this._value,this.format.decimals),r=l(t._value,t.format.decimals);return a.fromValue(e.add(r),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const e=l(this._value,this.format.decimals),r=l(t._value,t.format.decimals);return a.fromValue(e.sub(r),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const e=l(this._value,this.format.decimals),r=l(t._value,t.format.decimals);return a.fromValue(e.mul(r).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const e=l(this._value,this.format.decimals),r=l(t._value,t.format.decimals);return a.fromValue(e.mul(this.format._multiplier).div(r),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=a.from(t[0],this.format);const r=!t[1].match(/^(0*)$/);return this.isNegative()&&r&&(e=e.subUnsafe(L.toFormat(e.format))),e}ceiling(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=a.from(t[0],this.format);const r=!t[1].match(/^(0*)$/);return!this.isNegative()&&r&&(e=e.addUnsafe(L.toFormat(e.format))),e}round(t){t==null&&(t=0);const e=this.toString().split(".");if(e.length===1&&e.push("0"),(t<0||t>80||t%1)&&c.throwArgumentError("invalid decimal count","decimals",t),e[1].length<=t)return this;const r=a.from("1"+b.substring(0,t),this.format),i=nt.toFormat(this.format);return this.mulUnsafe(r).addUnsafe(i).floor().divUnsafe(r)}isZero(){return this._value==="0.0"||this._value==="0"}isNegative(){return this._value[0]==="-"}toString(){return this._value}toHexString(t){if(t==null)return this._hex;t%8&&c.throwArgumentError("invalid byte width","width",t);const e=m.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString();return N(e,t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return a.fromString(this._value,t)}static fromValue(t,e,r){return r==null&&e!=null&&!G(e)&&(r=e,e=null),e==null&&(e=0),r==null&&(r="fixed"),a.fromString(v(t,e),g.from(r))}static fromString(t,e){e==null&&(e="fixed");const r=g.from(e),i=l(t,r.decimals);!r.signed&&i.lt(R)&&q("unsigned value cannot be negative","overflow","value",t);let n=null;r.signed?n=i.toTwos(r.width).toHexString():(n=i.toHexString(),n=N(n,r.width/8));const o=v(i,r.decimals);return new a(y,n,o,r)}static fromBytes(t,e){e==null&&(e="fixed");const r=g.from(e);if(A(t).length>r.width/8)throw new Error("overflow");let i=m.from(t);r.signed&&(i=i.fromTwos(r.width));const n=i.toTwos((r.signed?0:1)+r.width).toHexString(),o=v(i,r.decimals);return new a(y,n,o,r)}static from(t,e){if(typeof t=="string")return a.fromString(t,e);if(J(t))return a.fromBytes(t,e);try{return a.fromValue(t,0,e)}catch(r){if(r.code!==w.errors.INVALID_ARGUMENT)throw r}return c.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!!(t&&t._isFixedNumber)}}const L=a.from(1),nt=a.from("0.5"),ot="units/5.7.0";new w(ot);const at=["wei","kwei","mwei","gwei","szabo","finney","ether"];function ct(s,t){if(typeof t=="string"){const e=at.indexOf(t);e!==-1&&(t=3*e)}return v(s,t!=null?t:18)}var ft=Object.defineProperty,ht=Object.getOwnPropertyDescriptor,ut=(s,t,e,r)=>{for(var i=r>1?void 0:r?ht(t,e):t,n=s.length-1,o;n>=0;n--)(o=s[n])&&(i=(r?o(t,e,i):o(i))||i);return r&&i&&ft(t,e,i),i};class H extends K{constructor(t){super(),this.key="",this.key=t}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}ut([Z({value:[]})],H.prototype,"queue",2);const lt=7200*1e3;class mt{constructor(t){this.provider=X().bridgeStore.bridge.provider,this.store=new H(`evm.txs.${t||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(t){if(!t.chainId){const{network:e}=this.provider;t.chainId=e.chainId,t.scan=e.scan}t.pending=!0,this.queue.unshift(t),this.store.save(),this.provider.nonce=+t.nonce+1}delDelay(t,e=0){setTimeout(()=>this.del(t),e)}del(t){var r,i;const e=(i=(r=t.hash)!=null?r:t.ts)!=null?i:t;this.queue.some((n,o)=>{if([n.hash,n.ts,n].includes(e)){o===0&&(this.provider.nonce=0);const f=this.queue.splice(o,1);return this.store.save(),f}})}async check(t){this.queue.forEach(async(e,r)=>{if(t&&r===0){const i=await Y(this.provider.account),n=+e.nonce;this.provider.nonce=n>i?n+1:i}if(e.done||new Date().getTime()-e.ts>=lt)return this.del(e);if(!e.err&&!(!t&&e.pending)){e.pending=!0;try{const i=await this.provider.provider.waitForTransaction(e.hash),{status:n}=i;e.status=n,n===1?(e.done=!0,this.del(e)):e.err=!0}catch(i){e.err=i}e.pending=!1}}),this.store.save()}}const j={},U=(s=W.bridge.account)=>j[s]||(j[s]=new mt(s)),dt=async s=>s?{}:{};class gt{constructor(t,{errorCodes:e="",seq:r=void 0,delay:i=0}={}){this.pending=!0,this.status=-1,this.txPromise=t,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=r,this.delay=i}get success(){return this.status===1}get ignored(){return this.status===3}async wait(t=!1){return(async()=>{let e=!1;const r=await dt(this.errorCodes);try{const i=await this.txPromise,{hash:n,nonce:o}=i;this.seq.nonce=o,this.seq&&(delete this.seq.overrides,U().add(Object.assign(this.seq,{hash:n}))),this.hash=n,this.status=2;const f=async()=>{const{status:h,events:u}=await i.wait(1);if(h!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");u.some(({event:S,args:T}={})=>{if(S==="Failure"){let{info:C,detail:P,error:x}=T;x=x.toString();const z={err:r[x],error:x,info:C==null?void 0:C.toString(),detail:P==null?void 0:P.toString()};throw this.seq&&(this.seq.err=!0),new Error(JSON.stringify(z))}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?U().delDelay(n,this.delay):U().del(n)};t?(e=!0,f()):await f()}catch(i){throw await D(i),this.status=0,i.code===4001&&(this.status=3),this.err=i,i}finally{this.pending=!1;const i=this.status===1;B.emit("tx-status",this.hash),i&&B.emit("tx-success",this.hash),e=i}return e})()}}const F={A:2,B:4,C:6},d=s=>[s,F[s]],wt={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":d("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":d("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":d("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":d("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":d("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":d("C")}},E=130,_=async()=>(await it()).bridge,k=async s=>s||(await _()).account,M=async()=>wt[(await _()).network.current.chainId],pt=async()=>Object.fromEntries(Object.entries(await M()).map(s=>[s[1][0],s[0]])),p=async s=>tt("Locker",{account:await k(s)}),O=s=>s.replace(/^0x/,""),yt=s=>`0x${O(s).slice(0,E)}`,$=s=>O(s).slice(E,E+1).toUpperCase(),bt=s=>(s=O(s),parseInt(s.slice(E+1,s.length)||"0",16)),St=s=>{var t,e;return(e=F[(t=$(s))!=null?t:"C"])!=null?e:F.C},Ct=async s=>{const t=await _(),e=A(et(st("C"))),r=t.provider.getSigner(s||t.account);let i="";try{i=await r.signMessage(e)}catch(n){throw await D(n)}return[i.replace("0x",""),"c","0"].join("")},Pt=async s=>await(await p()).nameExists(s),Ut=async(s,t=!1)=>{s||(s=await k());const e=await p(s);return console.info("getPasses",s),await e[t?"getUserPassesInfo":"getUserPassList"](s)},xt=async s=>{const t=await p();let e="";try{e=await t.getNameByHash(A(s))}catch(r){}return e},Ft=async(s,t)=>{var n;const e=await p(t),r=await M();let i={id:s,cate:"C",len:6,name:""};try{const[o,f,h]=await e.getUserPassInfo(s),u=(n=r[f])!=null?n:Object.values(i);i={id:o,cate:u[0],hash:h,len:u[1],name:await xt(h)}}catch(o){}return i},At=async(s,t="")=>{let{id:e,code:r,cate:i}=s;const n=!!e;e||(r=yt(s),i=(await pt())[$(s)],e=bt(s));const o=await p(),f=n?"lockName":"lockPass",h={},u=n?[+e,t]:[r,t,i,+e];await rt(h,o,f,u);const S=o[f](...u);return new gt(S,{seq:{type:n?"LockName":"lockPass",title:n?"Lock Name":"Lock Pass",ts:new Date().getTime(),overrides:h}})},It=async s=>{s||(s=await k());const e=await(await p(s)).getUserInvitedNumber(s);return ct(e[1],0)};export{Ct as a,Ft as b,Pt as c,It as d,p as e,Ut as f,St as g,M as h,ct as i,xt as j,At as l};
