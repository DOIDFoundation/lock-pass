System.register(["./index-legacy.6a078a54.js"],(function(t,e){"use strict";var r,s,i,a,o,n,c,h,u,l,d,f,m,g,w,v,b,p,y,x,S,F,_;return{setters:[t=>{r=t.L,s=t.F,i=t.G,a=t.H,o=t.I,n=t.J,c=t.K,h=t.M,u=t.O,l=t.c,d=t.P,f=t.Q,m=t.R,g=t.h,w=t.U,v=t._,b=t.V,p=t.X,y=t.D,x=t.Y,S=t.Z,F=t.$,_=t.a0}],execute:function(){t("i",$);const E=new r(s),k={},A=i.from(0),N=i.from(-1);function q(t,e,s,i){const a={fault:e,operation:s};return void 0!==i&&(a.value=i),E.throwError(t,r.errors.NUMERIC_FAULT,a)}let U="0";for(;U.length<256;)U+=U;function O(t){if("number"!=typeof t)try{t=i.from(t).toNumber()}catch(e){}return"number"==typeof t&&t>=0&&t<=256&&!(t%1)?"1"+U.substring(0,t):E.throwArgumentError("invalid decimal size","decimals",t)}function I(t,e){null==e&&(e=0);const r=O(e),s=(t=i.from(t)).lt(A);s&&(t=t.mul(N));let a=t.mod(r).toString();for(;a.length<r.length-1;)a="0"+a;a=a.match(/^([0-9]*[1-9]|0)(0*)/)[1];const o=t.div(r).toString();return t=1===r.length?o:o+"."+a,s&&(t="-"+t),t}function j(t,e){null==e&&(e=0);const r=O(e);"string"==typeof t&&t.match(/^-?[0-9.]+$/)||E.throwArgumentError("invalid decimal value","value",t);const s="-"===t.substring(0,1);s&&(t=t.substring(1)),"."===t&&E.throwArgumentError("missing value","value",t);const a=t.split(".");a.length>2&&E.throwArgumentError("too many decimal points","value",t);let o=a[0],n=a[1];for(o||(o="0"),n||(n="0");"0"===n[n.length-1];)n=n.substring(0,n.length-1);for(n.length>r.length-1&&q("fractional component exceeds decimals","underflow","parseFixed"),""===n&&(n="0");n.length<r.length-1;)n+="0";const c=i.from(o),h=i.from(n);let u=c.mul(r).add(h);return s&&(u=u.mul(N)),u}class P{constructor(t,e,s,i){t!==k&&E.throwError("cannot use FixedFormat constructor; use FixedFormat.from",r.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=e,this.width=s,this.decimals=i,this.name=(e?"":"u")+"fixed"+String(s)+"x"+String(i),this._multiplier=O(i),Object.freeze(this)}static from(t){if(t instanceof P)return t;"number"==typeof t&&(t=`fixed128x${t}`);let e=!0,r=128,s=18;if("string"==typeof t)if("fixed"===t);else if("ufixed"===t)e=!1;else{const i=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);i||E.throwArgumentError("invalid fixed format","format",t),e="u"!==i[1],r=parseInt(i[2]),s=parseInt(i[3])}else if(t){const i=(e,r,s)=>null==t[e]?s:(typeof t[e]!==r&&E.throwArgumentError("invalid fixed format ("+e+" not "+r+")","format."+e,t[e]),t[e]);e=i("signed","boolean",e),r=i("width","number",r),s=i("decimals","number",s)}return r%8&&E.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",r),s>80&&E.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",s),new P(k,e,r,s)}}class T{constructor(t,e,s,i){t!==k&&E.throwError("cannot use FixedNumber constructor; use FixedNumber.from",r.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=i,this._hex=e,this._value=s,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&E.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const e=j(this._value,this.format.decimals),r=j(t._value,t.format.decimals);return T.fromValue(e.add(r),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const e=j(this._value,this.format.decimals),r=j(t._value,t.format.decimals);return T.fromValue(e.sub(r),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const e=j(this._value,this.format.decimals),r=j(t._value,t.format.decimals);return T.fromValue(e.mul(r).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const e=j(this._value,this.format.decimals),r=j(t._value,t.format.decimals);return T.fromValue(e.mul(this.format._multiplier).div(r),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");1===t.length&&t.push("0");let e=T.from(t[0],this.format);const r=!t[1].match(/^(0*)$/);return this.isNegative()&&r&&(e=e.subUnsafe(C.toFormat(e.format))),e}ceiling(){const t=this.toString().split(".");1===t.length&&t.push("0");let e=T.from(t[0],this.format);const r=!t[1].match(/^(0*)$/);return!this.isNegative()&&r&&(e=e.addUnsafe(C.toFormat(e.format))),e}round(t){null==t&&(t=0);const e=this.toString().split(".");if(1===e.length&&e.push("0"),(t<0||t>80||t%1)&&E.throwArgumentError("invalid decimal count","decimals",t),e[1].length<=t)return this;const r=T.from("1"+U.substring(0,t),this.format),s=L.toFormat(this.format);return this.mulUnsafe(r).addUnsafe(s).floor().divUnsafe(r)}isZero(){return"0.0"===this._value||"0"===this._value}isNegative(){return"-"===this._value[0]}toString(){return this._value}toHexString(t){if(null==t)return this._hex;t%8&&E.throwArgumentError("invalid byte width","width",t);const e=i.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString();return a(e,t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return T.fromString(this._value,t)}static fromValue(t,e,r){return null!=r||null==e||o(e)||(r=e,e=null),null==e&&(e=0),null==r&&(r="fixed"),T.fromString(I(t,e),P.from(r))}static fromString(t,e){null==e&&(e="fixed");const r=P.from(e),s=j(t,r.decimals);!r.signed&&s.lt(A)&&q("unsigned value cannot be negative","overflow","value",t);let i=null;r.signed?i=s.toTwos(r.width).toHexString():(i=s.toHexString(),i=a(i,r.width/8));const o=I(s,r.decimals);return new T(k,i,o,r)}static fromBytes(t,e){null==e&&(e="fixed");const r=P.from(e);if(n(t).length>r.width/8)throw new Error("overflow");let s=i.from(t);r.signed&&(s=s.fromTwos(r.width));const a=s.toTwos((r.signed?0:1)+r.width).toHexString(),o=I(s,r.decimals);return new T(k,a,o,r)}static from(t,e){if("string"==typeof t)return T.fromString(t,e);if(c(t))return T.fromBytes(t,e);try{return T.fromValue(t,0,e)}catch(s){if(s.code!==r.errors.INVALID_ARGUMENT)throw s}return E.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!(!t||!t._isFixedNumber)}}const C=T.from(1),L=T.from("0.5");new r("units/5.7.0");const D=["wei","kwei","mwei","gwei","szabo","finney","ether"];function $(t,e){if("string"==typeof e){const t=D.indexOf(e);-1!==t&&(e=3*t)}return I(t,null!=e?e:18)}var B=Object.defineProperty,V=Object.getOwnPropertyDescriptor;class H extends u{constructor(t){super(),this.key="",this.key=t}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}((t,e,r,s)=>{for(var i,a=s>1?void 0:s?V(e,r):e,o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s?i(e,r,a):i(a))||a);s&&a&&B(e,r,a)})([h({value:[]})],H.prototype,"queue",2);class R{constructor(t){this.provider=d().bridgeStore.bridge.provider,this.store=new H(`evm.txs.${t||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(t){if(!t.chainId){const{network:e}=this.provider;t.chainId=e.chainId,t.scan=e.scan}t.pending=!0,this.queue.unshift(t),this.store.save(),this.provider.nonce=+t.nonce+1}delDelay(t,e=0){setTimeout((()=>this.del(t)),e)}del(t){const e=t.hash??t.ts??t;this.queue.some(((t,r)=>{if([t.hash,t.ts,t].includes(e)){0===r&&(this.provider.nonce=0);const t=this.queue.splice(r,1);return this.store.save(),t}}))}async check(t){this.queue.forEach((async(e,r)=>{if(t&&0===r){const t=await f(this.provider.account),r=+e.nonce;this.provider.nonce=r>t?r+1:t}if(e.done||(new Date).getTime()-e.ts>=72e5)return this.del(e);if(!e.err&&(t||!e.pending)){e.pending=!0;try{const t=await this.provider.provider.waitForTransaction(e.hash),{status:r}=t;e.status=r,1===r?(e.done=!0,this.del(e)):e.err=!0}catch(s){e.err=s}e.pending=!1}})),this.store.save()}}const z={},M=(t=l.bridge.account)=>z[t]||(z[t]=new R(t));class G{constructor(t,{errorCodes:e="",seq:r,delay:s=0,allowAlmostSuccess:i=!1}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=i,this.txPromise=t,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=r,this.delay=s}get success(){return 1===this.status}get almostSuccess(){return 4===this.status}get ignored(){return 3===this.status}async wait(t=!1){return(async()=>{let r=!1;const s=await(async t=>t?"object"==typeof t?t:await w(Object.assign({"./abi/Locker.codes.json":()=>v((()=>e.import("./Locker.codes-legacy.0f561214.js")),void 0)}),`./abi/${t}.codes.json`):{})(this.errorCodes);try{const e=await this.txPromise,{hash:i,nonce:a}=e;this.seq.nonce=a,this.seq&&(delete this.seq.overrides,M().add(Object.assign(this.seq,{hash:i}))),this.hash=i,this.status=2;const o=async()=>{const{status:t,events:r}=await e.wait(1);if(1!==t)throw this.seq&&(this.seq.err=!0),new Error("Failed");r.some((({event:t,args:e}={})=>{if("Failure"===t){let{info:t,detail:r,error:i}=e;const a=i.toString(),o=s[i],n={code:a,message:o,error:i,info:t?.toString(),detail:r?.toString()};this.seq&&(this.seq.err=!0);const c=new Error(o);throw Object.assign(c,{code:a,raw:n}),this.allowAlmostSuccess&&(this.status=4),c}})),this.status=1,this.seq&&(this.seq.done=!0),this.delay?M().delDelay(i,this.delay):M().del(i)};t?(r=!0,o()):await o()}catch(i){throw await m(i),4001===i.code?this.status=3:4!==this.status&&(this.status=0),this.err=i,i}finally{this.pending=!1;const t=1===this.status;g.emit("tx-status",this.hash),t&&g.emit("tx-success",this.hash),r=t}return r})()}}const J={A:2,B:4,C:6},Z=t=>[t,J[t]],K={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":Z("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":Z("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":Z("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":Z("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":Z("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":Z("C")}},Q=t("L",[64,130]),X=async()=>(await _()).bridge,Y=async t=>t||(await X()).account,W=t("h",(async()=>K[(await X()).network.current.chainId])),tt=t("e",(async t=>b("Locker",{account:await Y(t)}))),et=t=>t.replace(/^0x/,""),rt=t=>Q[t.length<Q[1]?0:1],st=t=>{t=et(t);const e=rt(t);return t.slice(e,e+1).toUpperCase()},it=(t("g",(t=>J[st(t)??"C"]??J.C)),t("a",(async t=>{t||(t=await Y(t));const e=await X(),r=p(y("C"));let s="";if("mainnet"===e.network.name){const a=e.provider.getSigner(t||e.account);try{s=await a.signMessage(n(r))}catch(i){throw await m(i)}}else s=x(BigInt(t)^BigInt(r));return[s.replace("0x",""),"c","0"].join("")})),t("c",(async t=>{const e=await tt();return await e.nameExists(t)})),t("f",(async(t,e=!1)=>{t||(t=await Y());const r=await tt(t);return await r[e?"getUserPassesInfo":"getUserPassList"](t)})),t("j",(async t=>{let e="";if(!t||t===S)return e;const r=await tt();try{e=await r.getNameByHash(n(t))}catch(s){}return e})));t("b",(async(t,e)=>{const r=await tt(e),s=await W();let i={id:t,cate:"C",len:6,name:""};try{const[e,a,o]=await r.getUserPassInfo(t),n=s[a]??Object.values(i);i={id:e,cate:n[0],hash:o,len:n[1],name:await it(o)}}catch(a){}return i})),t("l",(async(t,e="")=>{let{id:r,code:s,cate:i}=t;const a=!!r;r||(s=(t=>`0x${(t=et(t)).slice(0,rt(t))}`)(t),i=(await(async()=>Object.fromEntries(Object.entries(await W()).map((t=>[t[1][0],t[0]]))))())[st(t)],r=(t=>(t=et(t),parseInt(t.slice(rt(t)+1,t.length)||"0",16)))(t));const o=await tt(),n=a?"lockName":"lockPass",c={},h=a?[+r,e]:[s,e,i,+r];await F(c,o,n,h);const u=o[n](...h);return new G(u,{errorCodes:"Locker",allowAlmostSuccess:!0,seq:{type:a?"LockName":"lockPass",title:a?"Lock Name":"Lock Pass",ts:(new Date).getTime(),overrides:c}})})),t("d",(async t=>{t||(t=await Y());const e=await tt(t);return $((await e.getUserInvitedNumber(t))[1],0)}))}}}));
